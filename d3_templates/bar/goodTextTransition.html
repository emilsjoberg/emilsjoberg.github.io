<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script type="text/javascript" src="../../roark/d3/d3.v2.js"></script>
        <script type="text/javascript" src="../../roark/underscore/underscore.js"></script>
        <style type="text/css">

          .pone {
  margin-left: 60px;
  margin-top: 20px;
}

.axis path,
.axis line {
    fill: none;
    stroke: black;
  stroke-width
    shape-rendering: crispEdges;
}

.axis text {
    font-family: sans-serif;
    font-size: 11px;
}
        </style>
    </head>
    <body>
        <script type="text/javascript">


var buttonPositive = d3.select("body").append("button")
   .classed("pone", true)
   .text("positive");
    //.datum({count: 1000});
var buttonNegative = d3.select("body").append("button")
   .text("negative");
    //.datum({count: 500});
var buttonReset = d3.select("body").append("button")
    .text("reset");
    
var svg = d3.select("body").append("svg")
.attr({
  width:900,
  height:300
})

var data = [
    {'date': 'Oct 5', 'tweets': 12304},
    {'date': 'Oct 6', 'tweets': 9242},
    {'date': 'Oct 7', 'tweets': 4684},
    {'date': 'Oct 8', 'tweets': 11808},
    {'date': 'Oct 9', 'tweets': 15726},
    {'date': 'Oct 10', 'tweets': 21380},
    {'date': 'Oct 11', 'tweets': 15095},
    {'date': 'Oct 12', 'tweets': 27302},
    {'date': 'Oct 13', 'tweets': 11893},
    {'date': 'Oct 14', 'tweets': 9289},
    {'date': 'Oct 15', 'tweets': 26630},
    {'date': 'Oct 16', 'tweets': 23796},
    {'date': 'Oct 17', 'tweets': 16015},
    {'date': 'Oct 18', 'tweets': 18377},
    {'date': 'Oct 19', 'tweets': 19600},
    {'date': 'Oct 20', 'tweets': 12349},
    {'date': 'Oct 21', 'tweets': 17350},
    {'date': 'Oct 22', 'tweets': 47256},
    {'date': 'Oct 23', 'tweets': 38099},
    {'date': 'Oct 24', 'tweets': 29495},
    {'date': 'Oct 25', 'tweets': 134877},
    {'date': 'Oct 26', 'tweets': 151604},
    {'date': 'Oct 27', 'tweets': 67959},
    {'date': 'Oct 28', 'tweets': 44004},
    {'date': 'Oct 29', 'tweets': 53237},
    {'date': 'Oct 30', 'tweets': 60473},
    {'date': 'Oct 31', 'tweets': 39773},
    {'date': 'Nov 1', 'tweets': 35663},
    {'date': 'Nov 2', 'tweets': 30615},
    {'date': 'Nov 3', 'tweets': 18634},
    {'date': 'Nov 4', 'tweets': 18075}
];

var pos_data = [
    {'date': 'Oct 5', 'tweets': 1163},
    {'date': 'Oct 6', 'tweets': 3850},
    {'date': 'Oct 7', 'tweets': 685},
    {'date': 'Oct 8', 'tweets': 1295},
    {'date': 'Oct 9', 'tweets': 2227},
    {'date': 'Oct 10', 'tweets': 2581},
    {'date': 'Oct 11', 'tweets': 2192},
    {'date': 'Oct 12', 'tweets': 2162},
    {'date': 'Oct 13', 'tweets': 1173},
    {'date': 'Oct 14', 'tweets': 1454},
    {'date': 'Oct 15', 'tweets': 3512},
    {'date': 'Oct 16', 'tweets': 3189},
    {'date': 'Oct 17', 'tweets': 2258},
    {'date': 'Oct 18', 'tweets': 2780},
    {'date': 'Oct 19', 'tweets': 2462},
    {'date': 'Oct 20', 'tweets': 1631},
    {'date': 'Oct 21', 'tweets': 5644},
    {'date': 'Oct 22', 'tweets': 6743},
    {'date': 'Oct 23', 'tweets': 4724},
    {'date': 'Oct 24', 'tweets': 4395},
    {'date': 'Oct 25', 'tweets': 24129},
    {'date': 'Oct 26', 'tweets': 27531},
    {'date': 'Oct 27', 'tweets': 12946},
    {'date': 'Oct 28', 'tweets': 8053},
    {'date': 'Oct 29', 'tweets': 9194},
    {'date': 'Oct 30', 'tweets': 10855},
    {'date': 'Oct 31', 'tweets': 6674},
    {'date': 'Nov 1', 'tweets': 6619},
    {'date': 'Nov 2', 'tweets': 5529},
    {'date': 'Nov 3', 'tweets': 3548},
    {'date': 'Nov 4', 'tweets': 3282}
];

var neg_data = [
    {'date': 'Oct 5', 'tweets': 351},
    {'date': 'Oct 6', 'tweets': 197},
    {'date': 'Oct 7', 'tweets': 234},
    {'date': 'Oct 8', 'tweets': 263},
    {'date': 'Oct 9', 'tweets': 670},
    {'date': 'Oct 10', 'tweets': 1601},
    {'date': 'Oct 11', 'tweets': 717},
    {'date': 'Oct 12', 'tweets': 830},
    {'date': 'Oct 13', 'tweets': 457},
    {'date': 'Oct 14', 'tweets': 419},
    {'date': 'Oct 15', 'tweets': 1110},
    {'date': 'Oct 16', 'tweets': 1304},
    {'date': 'Oct 17', 'tweets': 826},
    {'date': 'Oct 18', 'tweets': 752},
    {'date': 'Oct 19', 'tweets': 829},
    {'date': 'Oct 20', 'tweets': 615},
    {'date': 'Oct 21', 'tweets': 696},
    {'date': 'Oct 22', 'tweets': 2415},
    {'date': 'Oct 23', 'tweets': 2587},
    {'date': 'Oct 24', 'tweets': 1495},
    {'date': 'Oct 25', 'tweets': 5503},
    {'date': 'Oct 26', 'tweets': 8914},
    {'date': 'Oct 27', 'tweets': 5294},
    {'date': 'Oct 28', 'tweets': 3102},
    {'date': 'Oct 29', 'tweets': 3482},
    {'date': 'Oct 30', 'tweets': 3767},
    {'date': 'Oct 31', 'tweets': 2553},
    {'date': 'Nov 1', 'tweets': 2065},
    {'date': 'Nov 2', 'tweets': 1935},
    {'date': 'Nov 3', 'tweets': 1582},
    {'date': 'Nov 4', 'tweets': 1390}
];

var resetdata = [
    {'date': 'Oct 5', 'tweets': 12304},
    {'date': 'Oct 6', 'tweets': 9242},
    {'date': 'Oct 7', 'tweets': 4684},
    {'date': 'Oct 8', 'tweets': 11808},
    {'date': 'Oct 9', 'tweets': 15726},
    {'date': 'Oct 10', 'tweets': 21380},
    {'date': 'Oct 11', 'tweets': 15095},
    {'date': 'Oct 12', 'tweets': 27302},
    {'date': 'Oct 13', 'tweets': 11893},
    {'date': 'Oct 14', 'tweets': 9289},
    {'date': 'Oct 15', 'tweets': 26630},
    {'date': 'Oct 16', 'tweets': 23796},
    {'date': 'Oct 17', 'tweets': 16015},
    {'date': 'Oct 18', 'tweets': 18377},
    {'date': 'Oct 19', 'tweets': 19600},
    {'date': 'Oct 20', 'tweets': 12349},
    {'date': 'Oct 21', 'tweets': 17350},
    {'date': 'Oct 22', 'tweets': 47256},
    {'date': 'Oct 23', 'tweets': 38099},
    {'date': 'Oct 24', 'tweets': 29495},
    {'date': 'Oct 25', 'tweets': 134877},
    {'date': 'Oct 26', 'tweets': 151604},
    {'date': 'Oct 27', 'tweets': 67959},
    {'date': 'Oct 28', 'tweets': 44004},
    {'date': 'Oct 29', 'tweets': 53237},
    {'date': 'Oct 30', 'tweets': 60473},
    {'date': 'Oct 31', 'tweets': 39773},
    {'date': 'Nov 1', 'tweets': 35663},
    {'date': 'Nov 2', 'tweets': 30615},
    {'date': 'Nov 3', 'tweets': 18634},
    {'date': 'Nov 4', 'tweets': 18075}
];  
  
var x = 60;
var y = 15;
var h = 225;
var w = 875; 
var bh = 190;
  
var xScale = d3.scale.ordinal()
    .domain(_.pluck(data, "date"))
    .rangeBands([0, w], 0.05)
    
var yScale = d3.scale.linear()
    .domain([0, d3.max(data, function(d) { return d.tweets; }) ])
    .range([0, bh]);

//var yFilterScale = d3.scale.linear()

var yInverse = d3.scale.linear()
    .domain([0, d3.max(data, function(d) { return d.tweets; })])
    .range([bh, 0]);

var yAxis = d3.svg.axis()
    .scale(yInverse)
    .orient("left")

var chart = svg.append("g")
    .attr("transform", "translate(" + [x,y] + ")");

chart.append("rect")
  .attr({
    id: "bg",
    height: h,
    width: w,
    fill: "lightgrey",
  })  
  
chart.append("g")
  .attr("id", "points")

//start of the function
function makeBars(data) {  

yScale
  .domain([0, d3.max(data, function(d) { return d.tweets; }) ])
  
var myBars = chart.select("#points").selectAll("rect")
      .data(data, function(d) { return d.date });
  
  myBars.enter()  
    .append("rect")
    .classed("bars", true)
    .attr({
      width: xScale.rangeBand(),
      x: function(d, i) {
        return xScale(d.date)
      }, 
      y: 200
    })
     
  myBars.exit()
    .transition()
    .duration(1000)
    .attr({
      height: 0,
      y: 225
    })
    .remove()
  
  myBars
    .transition() 
    .duration(1000) 
    .attr({
      width: xScale.rangeBand(),
      height: function(d, i) {
        return yScale(d.tweets)
      },
      x: function(d, i) {
        return xScale(d.date)//(i * 22) + 114; 
      },
      y: function(d, i) {
        return bh + 10 - yScale(d.tweets)
      }
  });
  var sum = d3.sum(data, function(d) { return d.tweets })
      chart.select("#clicks")
        .text("Total posts: " + sum)
        .attr("x", 10)
        .attr("y", 20)
} //END OF INITIAL FUNCTION
makeBars(data); 

//y axis
chart.append("g")
  .attr("class", "axis")
  .attr("transform", "translate(-5, " + (10) + ")")
  .call(yAxis);

//Positive clicks
buttonPositive 
  .on("click", function() {
    makeBars(pos_data);
  var sum = d3.sum(pos_data, function(d) { return d.tweets })
        chart.select("#clicks")
          .text("Total positive posts: " + sum)
          .attr("x", 10)  
          .attr("y", 20)
    })
//Negative clicks
buttonNegative
  .on("click", function() {
    makeBars(neg_data);
    var sum = d3.sum(neg_data, function(d) { return d.tweets })
        chart.select("#clicks")
          .text("Total negative posts: " + sum)
          .attr("x", 10)
          .attr("y", 20)
  })
//Reset button
buttonReset
  .on("click", function() {
    makeBars(resetdata);
    var sum = d3.sum(resetdata, function(d) { return d.tweets })
        chart.select("#clicks")
          .text("Total posts: " + sum)
          .attr("x", 10)
          .attr("y", 20)
  })
          
chart.append("text")
  .attr("id", "clicks")


        </script>
    </body>
</html> 